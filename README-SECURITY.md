# ğŸ” Crypto Alpha Scout å®‰å…¨æŒ‡å—

## å¯†é’¥ç®¡ç†æ¶æ„

### Infisical é›†æˆ

Crypto Alpha Scout ä½¿ç”¨ [Infisical](https://infisical.com/) ä½œä¸ºè‡ªæ‰˜ç®¡çš„å¯†é’¥ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œæ›¿ä»£ä¼ ç»Ÿçš„ `.env` æ–‡ä»¶ç®¡ç†æ–¹å¼ã€‚

#### æ¶æ„ä¼˜åŠ¿

1. **é›†ä¸­åŒ–ç®¡ç†**: æ‰€æœ‰å¯†é’¥åœ¨ä¸€ä¸ªå®‰å…¨çš„ä¸­å¿ƒä½ç½®ç®¡ç†
2. **ç‰ˆæœ¬æ§åˆ¶**: å¯†é’¥å˜æ›´çš„å®Œæ•´å®¡è®¡è½¨è¿¹
3. **ç¯å¢ƒéš”ç¦»**: å¼€å‘/æµ‹è¯•/ç”Ÿäº§ç¯å¢ƒå¯†é’¥å®Œå…¨éš”ç¦»
4. **è®¿é—®æ§åˆ¶**: ç»†ç²’åº¦çš„ç”¨æˆ·æƒé™ç®¡ç†
5. **è‡ªåŠ¨è½®æ¢**: æ”¯æŒå¯†é’¥çš„è‡ªåŠ¨å®šæœŸè½®æ¢
6. **é›¶ä¿¡ä»»**: åº”ç”¨è¿è¡Œæ—¶åŠ¨æ€è·å–å¯†é’¥ï¼Œæ— éœ€æœ¬åœ°å­˜å‚¨

### éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åº”ç”¨æœåŠ¡      â”‚    â”‚   Infisical     â”‚    â”‚   MongoDB       â”‚
â”‚                 â”‚    â”‚   (å¯†é’¥ç®¡ç†)    â”‚    â”‚   (å¯†é’¥å­˜å‚¨)    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Scout       â”‚â”€â”¼â”€â”€â”€â”€â”¤ â”‚ API Server  â”‚â”€â”¼â”€â”€â”€â”€â”¤ â”‚ Encrypted   â”‚ â”‚
â”‚ â”‚ Services    â”‚ â”‚    â”‚ â”‚             â”‚ â”‚    â”‚ â”‚ Storage     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                 â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”‚ Web UI      â”‚ â”‚
â”‚ â”‚ ML Engine   â”‚â”€â”¼â”€â”€â”€â”€â”¤ â”‚             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å®‰å…¨é…ç½®

### 1. åˆå§‹éƒ¨ç½²

```bash
# 1. å¯åŠ¨åŸºç¡€è®¾æ–½
docker-compose up -d infisical-mongo infisical

# 2. ç­‰å¾…æœåŠ¡å°±ç»ª
sleep 60

# 3. åˆå§‹åŒ–å¯†é’¥
python3 scripts/setup-secrets.py

# 4. å¯åŠ¨åº”ç”¨æœåŠ¡
docker-compose up -d
```

### 2. å¯†é’¥é…ç½®

#### ç”Ÿäº§ç¯å¢ƒå¯†é’¥æ¸…å•

| ç±»åˆ« | å¯†é’¥åç§° | æè¿° | ç¤ºä¾‹ |
|------|----------|------|------|
| æ•°æ®åº“ | `DATABASE_URL` | TimescaleDBè¿æ¥å­—ç¬¦ä¸² | `postgresql://user:pass@host:5432/db` |
| æ¶ˆæ¯é˜Ÿåˆ— | `RABBITMQ_URL` | RabbitMQè¿æ¥å­—ç¬¦ä¸² | `amqp://user:pass@host:5672/` |
| ç¼“å­˜ | `REDIS_URL` | Redisè¿æ¥å­—ç¬¦ä¸² | `redis://host:6379/0` |
| APIå¯†é’¥ | `ETHERSCAN_API_KEY` | Etherscan APIå¯†é’¥ | `ABC123...` |
| APIå¯†é’¥ | `GOPLUS_API_KEY` | GoPluså®‰å…¨APIå¯†é’¥ | `DEF456...` |
| é€šçŸ¥ | `TELEGRAM_BOT_TOKEN` | Telegramæœºå™¨äººä»¤ç‰Œ | `123456:ABC-DEF...` |
| å®‰å…¨ | `JWT_SECRET` | JWTç­¾åå¯†é’¥ | `éšæœº32å­—ç¬¦å­—ç¬¦ä¸²` |
| å®‰å…¨ | `ENCRYPTION_KEY` | æ•°æ®åŠ å¯†å¯†é’¥ | `éšæœº32å­—ç¬¦å­—ç¬¦ä¸²` |

### 3. è®¿é—®æ§åˆ¶

#### Service Token ç®¡ç†

```python
# è·å–æœåŠ¡ä»¤ç‰Œ
import asyncio
from scripts.infisical_integration import InfisicalSecretManager

async def get_service_token():
    manager = InfisicalSecretManager(
        infisical_url="http://localhost:8090",
        project_id="your-project-id"
    )
    
    # åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨æ³¨å…¥å¯†é’¥
    await manager.inject_secrets_to_env()
```

#### æƒé™æ¨¡å‹

1. **ç®¡ç†å‘˜**: å®Œæ•´çš„é¡¹ç›®å’Œå¯†é’¥ç®¡ç†æƒé™
2. **å¼€å‘è€…**: è¯»å–å¼€å‘ç¯å¢ƒå¯†é’¥
3. **åº”ç”¨æœåŠ¡**: ä»…è¯»å–ç”Ÿäº§ç¯å¢ƒæ‰€éœ€å¯†é’¥
4. **å®¡è®¡å‘˜**: åªè¯»è®¿é—®å®¡è®¡æ—¥å¿—

### 4. å¯†é’¥è½®æ¢

#### è‡ªåŠ¨è½®æ¢ç­–ç•¥

```yaml
# config/rotation-policy.yaml
rotation_policies:
  jwt_secret:
    interval: "30d"
    notification: true
  
  api_keys:
    interval: "90d" 
    notification: true
    
  database_passwords:
    interval: "180d"
    notification: true
    require_approval: true
```

#### æ‰‹åŠ¨è½®æ¢æµç¨‹

```bash
# 1. ç”Ÿæˆæ–°å¯†é’¥
python3 scripts/rotate-secret.py --key JWT_SECRET

# 2. éªŒè¯åº”ç”¨åŠŸèƒ½
python3 scripts/health-check.py

# 3. ç¡®è®¤è½®æ¢
python3 scripts/confirm-rotation.py --key JWT_SECRET
```

## å®‰å…¨æœ€ä½³å®è·µ

### 1. ç½‘ç»œå®‰å…¨

```yaml
# docker-compose.yml ç½‘ç»œé…ç½®
networks:
  crypto-network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/16
```

- æ‰€æœ‰æœåŠ¡è¿è¡Œåœ¨éš”ç¦»çš„Dockerç½‘ç»œä¸­
- åªæš´éœ²å¿…è¦çš„ç«¯å£åˆ°ä¸»æœº
- ä½¿ç”¨å†…éƒ¨DNSè¿›è¡ŒæœåŠ¡é—´é€šä¿¡

### 2. å®¹å™¨å®‰å…¨

```dockerfile
# ä½¿ç”¨érootç”¨æˆ·
RUN adduser --disabled-password --gecos '' appuser
USER appuser

# åªå®‰è£…å¿…è¦çš„åŒ…
RUN apt-get update && apt-get install -y --no-install-recommends \
    required-package \
    && rm -rf /var/lib/apt/lists/*

# è®¾ç½®åªè¯»æ–‡ä»¶ç³»ç»Ÿ
docker run --read-only --tmpfs /tmp myapp
```

### 3. æ•°æ®åŠ å¯†

#### ä¼ è¾“åŠ å¯†
- æ‰€æœ‰APIé€šä¿¡ä½¿ç”¨HTTPS/TLS
- å†…éƒ¨æœåŠ¡é—´é€šä¿¡ä½¿ç”¨TLS
- æ•°æ®åº“è¿æ¥ä½¿ç”¨SSL

#### å­˜å‚¨åŠ å¯†
- æ•æ„Ÿæ•°æ®ä½¿ç”¨AES-256åŠ å¯†
- å¯†é’¥ä½¿ç”¨HSMæˆ–äº‘å¯†é’¥ç®¡ç†æœåŠ¡
- æ•°æ®åº“é€æ˜æ•°æ®åŠ å¯†(TDE)

### 4. å®¡è®¡æ—¥å¿—

```python
# è‡ªåŠ¨è®°å½•æ‰€æœ‰å¯†é’¥è®¿é—®
import logging

audit_logger = logging.getLogger('security.audit')
audit_logger.info(f"Secret accessed: {key_name} by {user_id} at {timestamp}")
```

## ç›‘æ§å’Œå‘Šè­¦

### 1. å®‰å…¨ç›‘æ§

```yaml
# prometheus è§„åˆ™
groups:
  - name: security
    rules:
      - alert: UnauthorizedSecretAccess
        expr: rate(infisical_unauthorized_access[5m]) > 0
        
      - alert: SuspiciousActivity
        expr: rate(failed_logins[1m]) > 10
        
      - alert: SecretRotationDue
        expr: time() - secret_last_rotation > 2592000  # 30å¤©
```

### 2. å¥åº·æ£€æŸ¥

```bash
# å®šæœŸå®‰å…¨æ£€æŸ¥
./scripts/security-audit.sh

# æ£€æŸ¥é¡¹ç›®:
# - è¿‡æœŸå¯†é’¥
# - æœªä½¿ç”¨çš„å¯†é’¥
# - æƒé™å¼‚å¸¸
# - å®¡è®¡æ—¥å¿—å¼‚å¸¸
```

## åº”æ€¥å“åº”

### 1. å¯†é’¥æ³„éœ²å“åº”

```bash
# 1. ç«‹å³æ’¤é”€æ³„éœ²çš„å¯†é’¥
python3 scripts/revoke-secret.py --key LEAKED_KEY --emergency

# 2. ç”Ÿæˆæ–°å¯†é’¥
python3 scripts/generate-secret.py --key LEAKED_KEY

# 3. æ›´æ–°æ‰€æœ‰ä½¿ç”¨è¯¥å¯†é’¥çš„æœåŠ¡
python3 scripts/update-services.py --key LEAKED_KEY

# 4. å®¡è®¡è®¿é—®æ—¥å¿—
python3 scripts/audit-access.py --key LEAKED_KEY --since "2024-01-01"
```

### 2. ç³»ç»Ÿå…¥ä¾µå“åº”

```bash
# 1. éš”ç¦»å—å½±å“çš„æœåŠ¡
docker-compose stop affected-service

# 2. è½®æ¢æ‰€æœ‰å¯†é’¥
python3 scripts/emergency-rotation.py --all

# 3. é‡æ–°éƒ¨ç½²å¹²å‡€çš„é•œåƒ
docker-compose up -d --force-recreate

# 4. åˆ†æå…¥ä¾µè·¯å¾„
python3 scripts/forensic-analysis.py
```

## åˆè§„æ€§

### 1. æ•°æ®ä¿æŠ¤æ³•è§„

- **GDPR**: ç”¨æˆ·æ•°æ®åŠ å¯†å­˜å‚¨ï¼Œæ”¯æŒæ•°æ®åˆ é™¤
- **SOX**: å®Œæ•´çš„å®¡è®¡è½¨è¿¹å’Œè®¿é—®æ§åˆ¶
- **PCI DSS**: æ”¯ä»˜ç›¸å…³æ•°æ®çš„å®‰å…¨å¤„ç†

### 2. å®‰å…¨æ ‡å‡†

- **ISO 27001**: ä¿¡æ¯å®‰å…¨ç®¡ç†ä½“ç³»
- **NIST**: ç½‘ç»œå®‰å…¨æ¡†æ¶
- **OWASP**: Webåº”ç”¨å®‰å…¨æœ€ä½³å®è·µ

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **Infisicalè¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥ç½‘ç»œè¿æ¥
   docker-compose logs infisical
   
   # éªŒè¯é…ç½®
   curl http://localhost:8090/api/status
   ```

2. **å¯†é’¥è·å–å¤±è´¥**
   ```bash
   # æ£€æŸ¥service token
   python3 scripts/test-token.py
   
   # éªŒè¯é¡¹ç›®æƒé™
   python3 scripts/check-permissions.py
   ```

3. **æœåŠ¡è®¤è¯å¤±è´¥**
   ```bash
   # é‡æ–°ç”Ÿæˆtoken
   python3 scripts/regenerate-token.py
   
   # æ›´æ–°æœåŠ¡é…ç½®
   docker-compose restart affected-service
   ```

---

**é‡è¦æé†’**: 
- å®šæœŸæ›´æ–°æ‰€æœ‰å¯†é’¥
- ç›‘æ§å¼‚å¸¸è®¿é—®æ¨¡å¼
- ä¿æŒç³»ç»Ÿå’Œä¾èµ–é¡¹æ›´æ–°
- å®šæœŸè¿›è¡Œå®‰å…¨å®¡è®¡
- å¤‡ä»½å…³é”®é…ç½®å’Œå¯†é’¥
